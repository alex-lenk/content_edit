<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="content_edit/js/jquery.js"></script>

    <link rel="stylesheet" href="content_edit/css/editable.css">

</head>
<body onBeforeUnload="return doUnload();">

<p class="edit">X-editable: change buttons style</p>
<a href="#" class="edit">awesome</a>

<p><a href="#">Это тестовая ссылка</a></p>
<p><a href="/page.html">Это тестовая ссылка на внутреннюю страницу</a></p>
<p><a href="http://artlenk.ru/">Это тестовая ссылка на другой сайт</a></p>
<p><a href="http://artlenk.ru/" target="_blank">Это тестовая ссылка на другой сайт в новом окне</a></p>


<script src="content_edit/js/editable.js"></script>

<script>
    $(document).ready(function () {
        $('.edit').editable({
            type: 'textarea',
            url: '/post',
            pk: 1,
            placement: 'bottom',
            title: 'Enter comments'
        });

        //modify buttons style
        $.fn.editableform.buttons =
                '<button type="submit" class="btn btn-success editable-submit"><i class="glyphicon glyphicon-ok"></i></button>' +
                '<button type="button" class="btn editable-cancel"><i class="glyphicon glyphicon-remove"></i></button>';


        //ajax emulation
        $.mockjax({
            url: '/post',
            responseTime: 400,
            response: function (settings) {
                if (settings.data.value == 'err') {
                    this.status = 500;
                    this.responseText = 'Server-side error';
                } else {
                    this.responseText = "";
                }
            }
        });


        /* Переход по ссылкам и вопрос о закрытии окна браузера */
        function Unloader() {

            var o = this;

            this.unload = function (evt) {
                var message = "Вы уверены, что хотите покинуть страницу оформления заказа?";
                if (typeof evt == "undefined") {
                    evt = window.event;
                }
                if (evt) {
                    evt.returnValue = message;
                }
                return message;
            };

            this.resetUnload = function () {
                $(window).off('beforeunload', o.unload);

                setTimeout(function () {
                    $(window).on('beforeunload', o.unload);
                }, 2000);
            };

            this.init = function () {

                $(window).on('beforeunload', o.unload);

                $('a').on('click', function () {
                    o.resetUnload
                });
                $(document).on('submit', 'form', function () {
                    o.resetUnload
                });
                $(document).on('keydown', function (event) {
                    if ((event.ctrlKey && event.keyCode == 116) || event.keyCode == 116) {
                        o.resetUnload;
                    }
                });
            };
            this.init();
        }

        $(function () {
            if (typeof window.obUnloader != 'object') {
                window.obUnloader = new Unloader();
            }
        });


        /* Перехватываем нажатия: F5, CTRL+F5, CTRL+R, CTRL+SHIFT+R */
        document.onkeydown = function (e) {
            if (e.key === 'F5' || e.keyCode == 116 || // F5 or CTRL+F5
                    (e.key === 'r' || e.key === 'R' || e.keyCode == 82) && e.ctrlKey // CTRL+R
            ) {
                return false;
            }
        };

        window.onload = function () {
            alert('Страница загрузилась, приступайте к переводу.');
        }
    });
</script>
</body>
</html>
